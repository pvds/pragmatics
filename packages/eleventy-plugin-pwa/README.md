# eleventy-plugin-pwa

An [Eleventy](https://11ty.io) plugin to generate service worker.
Using Google Workbox to generate service-worker.js based on your `dir.output`.

### Note

Since (at this moment) `eleventy` doesn't have any API to do a things after build process, this plugin are using monkey patch method to wrap into the `finish` function in order to run workbox properly.

## Installation

```bash
npm i eleventy-plugin-pwa
```

#### in Eleventy config file

```js
const pluginPWA = require("eleventy-plugin-pwa");
module.exports = function(eleventyConfig) {
  eleventyConfig.addPlugin(pluginPWA);
};
```

Read more about [Eleventy plugins](https://www.11ty.io/docs/plugins/).

### Registering Service Worker

To make it works when you're updating your content, you should cache-busting the path.
The simplest way to do it is using eleventy's addFilter.

#### in the template (header/footer)

```html
<script>
  if ("serviceWorker" in navigator) {
    // default filename generated by plugin + cache busting via eleventy's filter
    navigator.serviceWorker
      .register("{{ '/service-worker.js' | cacheBust }}")
      .then(function() {
        console.log("ServiceWorker has been registered!");
      })
      .catch(console.error);
  }
</script>
```

#### in Eleventy config file

```js
// append "?v=timestamp" to the end of str
eleventyConfig.addFilter("cacheBust", (str) => {
  const dateNow = Date.now();
  return str.concat(`?v=${dateNow}`);
});
```

### Manifest file for the browser

#### ./manifest.json

for example:

```json
{
  "name": "Nanda Okitavera",
  "short_name": "okitavera",
  "icons": [
    {
      "src": "/assets/img/favicon/192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/assets/img/favicon/512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ],
  "theme_color": "#ec407a",
  "background_color": "#ec407a",
  "display": "standalone"
}
```

#### inside your header template

```html
<link rel="manifest" href="/manifest.json" />
```

#### tell eleventy to copy the manifest.json to the output dir.

```js
eleventyConfig.addPassthroughCopy("manifest.json");
```

## Options

You can also pass workbox generateSW options directly into the plugin.
For example :

```js
// overwriting destination file and more
const pluginPWA = require("eleventy-plugin-pwa");
module.exports = function(eleventyConfig) {
  eleventyConfig.addPlugin(pluginPWA, {
    swDest: "./build/sw.js",
    globDirectory: "./build",
    clientsClaim: true,
    skipWaiting: true
  });
};
```

Read more about it on [workbox generateSW module page](https://developers.google.com/web/tools/workbox/modules/workbox-build#full_generatesw_config)

## License

This code is available under the [MIT license](LICENSE).
